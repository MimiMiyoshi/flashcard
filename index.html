<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å˜èªå¸³</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body>
    <div id="background"></div>
    <div id="content">
      <h1>å˜èªã‚’ç™»éŒ²ã—ã¾ã—ã‚‡ï¼</h1>
      <div>
        <label for="word">å˜èª:</label>
        <input type="text" id="word" placeholder="å˜èªã‚’å…¥åŠ›ã—ã¦ã­" required />
      </div>
      <div>
        <label for="type">å“è©:</label>
        <select name="type" id="type" required>
          <option value="">é¸ã‚“ã§ã­</option>
          <option value="noun">åè©</option>
          <option value="verb">å‹•è©</option>
          <option value="adverb">å‰¯è©</option>
          <option value="adjective">å½¢å®¹è©</option>
          <option value="preposition">å‰ç½®è©</option>
          <option value="idiom">ç†Ÿèª</option>
          <option value="other">ãã®ä»–</option>
        </select>
      </div>
      <div>
        <label for="meaning">æ„å‘³:</label>
        <input
          type="text"
          id="meaning"
          placeholder="å˜èªã®æ„å‘³ã‚’å…¥åŠ›ã—ã¦ã­"
          required
        />
      </div>
      <div>
        <label for="phrase">ä¾‹æ–‡ã‚„ãƒ¡ãƒ¢:</label>
        <textarea
          name="phrase"
          id="phrase"
          placeholder="ä¾‹æ–‡ã‚„ãƒ¡ãƒ¢ã‚’å…¥åŠ›ã—ã¦ã­"
        ></textarea>
      </div>
      <div class="button-container">
        <button id="send" type="button" class="send">ç™»éŒ²ã™ã‚‹</button>
        <button
          id="notepad-btn"
          class="link"
          onclick="location.href='notepad.html'"
        >
          å˜èªå¸³ã‚’é–‹ã
        </button>
      </div>
      <div id="output"></div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        push,
        set,
        onChildAdded,
        remove,
        onChildRemoved,
      } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
      // Your web app's Firebase configuration



      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app); //RealtimeDBã«æ¥ç¶š
      const dbRef = ref(db, "vocabulary"); //RealtimeDBå†…ã®"vocabulary"ã‚’ä½¿ã†

      // å“è©ã®è‹±èªåã‹ã‚‰æ—¥æœ¬èªåã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°
      const typeMapping = {
        noun: "åè©",
        verb: "å‹•è©",
        adverb: "å‰¯è©",
        adjective: "å½¢å®¹è©",
        preposition: "å‰ç½®è©",
        idiom: "ç†Ÿèª",
        other: "ãã®ä»–",
      };
      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
      document.addEventListener("DOMContentLoaded", function () {
        console.log("ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸã€‚createDotã‚’é–‹å§‹ã—ã¾ã™ã€‚");
        // ãƒ‰ãƒƒãƒˆã‚’ç”Ÿæˆã—ã¦èƒŒæ™¯ã«è¿½åŠ ã™ã‚‹é–¢æ•°
        function createDot() {
          const background = document.getElementById("background");

          // èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º
          if (!background) {
            console.error("èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ (#background) ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
            return;
          }

          const dot = document.createElement("div");
          dot.classList.add("dot");

          // ãƒ©ãƒ³ãƒ€ãƒ ãªã‚µã‚¤ã‚ºã¨ä½ç½®
          const size = Math.random() * 10 + 5; // 5pxã€œ15pxã®ã‚µã‚¤ã‚º
          dot.style.width = `${size}px`;
          dot.style.height = `${size}px`;
          dot.style.left = `${Math.random() * 100}vw`; // ç”»é¢å¹…ã®ãƒ©ãƒ³ãƒ€ãƒ ãªä½ç½®
          dot.style.animationDuration = `${Math.random() * 5 + 5}s`; // 5ã€œ10ç§’ã§è½ä¸‹

          // èƒŒæ™¯ã«è¿½åŠ 
          background.appendChild(dot);

          // ä¸€å®šæ™‚é–“å¾Œã«ãƒ‰ãƒƒãƒˆã‚’å‰Šé™¤
          setTimeout(() => {
            background.removeChild(dot);
          }, 10000); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã«å‰Šé™¤
        }

        // ãƒ‰ãƒƒãƒˆã‚’å®šæœŸçš„ã«ç”Ÿæˆ
        setInterval(createDot, 500); // 0.5ç§’ã”ã¨ã«ãƒ‰ãƒƒãƒˆã‚’ç”Ÿæˆ
      });

      //å˜èªã‚’ç™»éŒ²ã™ã‚‹(Click)
      $("#send").on("click", function () {
        console.log(phrase);
        const tango = {
          word: $("#word").val(),
          type: $("#type").val(),
          meaning: $("#meaning").val(),
          phrase: $("#phrase").val(),
        };

        const newPostRef = push(dbRef);
        set(newPostRef, tango);

        //å…¥åŠ›æ¬„ã‚’ç©ºã«ã™ã‚‹
        $("#word").val("");
        $("#type").val("");
        $("#meaning").val("");
        $("#phrase").val("");
      });

      //ãƒ‡ãƒ¼ã‚¿ç™»éŒ²(Enter)
      $("#phrase").on("keydown", function (e) {
        console.log(e); //eå¤‰æ•°ã®ä¸­èº«ã‚’ç¢ºèªï¼ï¼
        if (e.keyCode == 13) {
          //EnterKey=13
          const tango = {
            word: $("#word").val(),
            type: $("#type").val(),
            meaning: $("#meaning").val(),
            phrase: $("#phrase").val(),
          };
          const newPostRef = push(dbRef); //ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ç”Ÿæˆ
          set(newPostRef, tango); //"chat"ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ã¤ã‘ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²
        }
      });

      // ç”»é¢èª­ã¿è¾¼ã¿æ™‚ã«ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’è¿½åŠ 
      $(document).ready(function () {
        const headerHTML = `
    <table id="list">
      <thead>
        <tr>
          <th>å˜èª</th>
          <th>å“è©</th>
          <th>æ„å‘³</th>
          <th>ä¾‹æ–‡ãƒ»ãã®ä»–</th>
        </tr>
      </thead>
      <tbody id="list_body">
      </tbody>
    </table>
  `;

        // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å‡ºåŠ›ã‚¨ãƒªã‚¢ã«è¿½åŠ 
        $("#output").html(headerHTML);
      });

      //æœ€åˆã«ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼†onSnapshotã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      onChildAdded(dbRef, function (data) {
        const tango = data.val();
        // ãƒ‡ãƒãƒƒã‚°: å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã¨ãã®å‹ã‚’ç¢ºèª
        console.log("tango:", tango); // ãƒ‡ãƒ¼ã‚¿å…¨ä½“
        console.log("tango.phrase:", tango.phrase); // `phrase`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤
        console.log("typeof tango.phrase:", typeof tango.phrase); // ãƒ‡ãƒ¼ã‚¿å‹ã‚’ç¢ºèª
        console.log("tango.phrase === undefined:", tango.phrase === undefined); // undefinedã‹ã‚’ç¢ºèª

        const key = data.key;
        // `typeMapping` ã‚’ä½¿ã£ã¦å“è©ã‚’æ—¥æœ¬èªã«å¤‰æ›
        const japaneseType = typeMapping[tango.type] || tango.type; // ãƒãƒƒãƒ”ãƒ³ã‚°ãŒãªã„å ´åˆã¯è‹±èªã‚’ãã®ã¾ã¾è¡¨ç¤º
        let h = `
            <div id="list_area">
      <table id="list">
        <tr>
          <td>${tango.word}</td>
          <td>${japaneseType}</td>
          <td>${tango.meaning}</td>
          <td>${tango.phrase}</td>
        </tr>
      </table>
    </div>
            `;

        // jQueryã‚’ä½¿ã£ã¦ç”»é¢ã«è¡¨ç¤ºã—ã¾ã—ã‚‡ã†ğŸ¤—
        $("#output").append(h);
        console.log($("#output").html()); // å‡ºåŠ›ã•ã‚ŒãŸHTMLã‚’ç¢ºèª
      });
    </script>
  </body>
</html>
